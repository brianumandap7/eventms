{% extends 'eventapp/basetemp.html' %}
{% block content %}
{% load crispy_forms_tags %}
{% load static %}

{% if request.user.is_superuser %}

{% elif request.user.is_staff %}

{% else %}

<script>
    window.location.href = '/eventapp/stu';

</script>

{% endif %}

{% if request.user.username == "ips.server" %}
  <script>
    window.location.href = 'http://{% for items in ipsurl %}{{items.ipsurl}}{% endfor %}:8000/eventapp/radar_dash/';
  </script>
{% endif %}

<style>
  .btn-custom, .btn-custom:hover {
        background-color: #092D13;
        color: white;
    }

    progress .progress-bar:hover:after {
      display: block !important;
      content: attr(value) !important;
    }
</style>
<div class="container-lg">

  <div class="modal fade" id="passwordChangeModal" tabindex="-1" role="dialog" aria-labelledby="passwordChangeModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="passwordChangeModalLabel">Change Password Required</h5>

                </div>
                <div class="modal-body">
                    <!-- Password change form goes here -->
                    <form method="POST">
                        {% csrf_token %}
                        <!-- Include form fields for the new password -->
                        <!-- For example: -->
                        <label for="new_password"><strong>New Password:</strong></label>
                        <input type="password" name="new_password" id="id_password1" class="form-control">
                        <div id="password-alert" class="alert" role="alert"></div>
                        <br>
                        <!-- Add any other required form fields -->
                        <button type="submit" class="btn btn-custom">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
      </div>
      <!-- end of modal pass -->

      <script>
          $(document).ready(function () {
              // Check if new_pass is '0' or if UserProfile doesn't exist
              {% if user.userprofile.new_pass == '0' or not user.userprofile %}
                  // Show the password change modal
                  $('#passwordChangeModal').modal('show');
              {% endif %}
          });
      </script>   
          <div class="row">
            <div class="col-sm-6 col-lg-3">
              <div class="card mb-4 text-white bg-primary">
                <div class="card-body pb-0 d-flex justify-content-between align-items-start">
                  <div>
                    <div class="fs-4 fw-semibold">{{s_count}}
                      <span class="fs-6 fw-normal">
                        <svg class="icon">
                          <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-arrow-bottom"></use>
                        </svg>
                      </span>
                    </div>
                    <div>Users <small>(Students/Teachers/Guests)</small></div>
                  </div>
                
                </div>
                <div class="c-chart-wrapper mt-3 mx-3" style="height:70px;">
                  
                </div>
              </div>
            </div>
            <!-- /.col-->
            <div class="col-sm-6 col-lg-3">
              <div class="card mb-4 text-white bg-info">
                <div class="card-body pb-0 d-flex justify-content-between align-items-start">
                  <div>
                    <div class="fs-4 fw-semibold">{{t_count}}
                      <span class="fs-6 fw-normal">
                        <svg class="icon">
                          <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-arrow-top"></use>
                        </svg>
                      </span>
                    </div>
                    <div>Student Affairs Admin</div>
                  </div>
                  
                </div>
                <div class="c-chart-wrapper mt-3 mx-3" style="height:70px;">
                  
                </div>
              </div>
            </div>
            <!-- /.col-->
            <div class="col-sm-6 col-lg-3">
              <div class="card mb-4 text-white bg-warning">
                <div class="card-body pb-0 d-flex justify-content-between align-items-start">
                  <div>
                    <div class="fs-4 fw-semibold">{{u_count}}
                      <span class="fs-6 fw-normal">
                        <svg class="icon">
                          <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-arrow-top"></use>
                        </svg>
                      </span>
                    </div>
                    <div>Upcoming Events</div>
                  </div>
                  
                </div>
                <div class="c-chart-wrapper mt-3" style="height:70px;">
                 
                </div>
              </div>
            </div>
            <!-- /.col-->
            <div class="col-sm-6 col-lg-3">
              <div class="card mb-4 text-white bg-danger">
                <div class="card-body pb-0 d-flex justify-content-between align-items-start">
                  <div>
                      <div class="fs-4 fw-semibold">0 <span class="fs-6 fw-normal">
                        <svg class="icon">
                          
                        </svg>
                      </div>
                    <div>Reviews and Feedbacks
                    </div>
                  </div>
                 
                </div>
                <div class="c-chart-wrapper mt-3 mx-3" style="height:70px;">
                  
                </div>
              </div>
            </div>
            <!-- /.col-->
          </div>
          <!-- /.row-->
          

          <div class="card mb-4">
            
            <div class="card-footer">
              <div class="row row-cols-1 row-cols-md-5 text-center">
                <div class="col mb-sm-2 mb-0">
                  <div class="text-medium-emphasis">Active Users Rate <br><strong>({{active_percentage|floatformat:2}}%)</strong></div>
                  <div class="fw-semibold"></div>
                  <div class="progress progress-thin mt-2">
                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ active_percentage }}%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>

                <div class="col mb-sm-2 mb-0">
                  <div class="text-medium-emphasis">Inactive Users Rate <br><strong>({{inactive_percentage|floatformat:2}}%)</strong></div>
                  <div class="progress progress-thin mt-2">
                    <div class="progress-bar" role="progressbar" style="width: {{ inactive_percentage }}%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>
                <div class="col mb-sm-2 mb-0">
                  <div class="text-medium-emphasis">Events Cancelled Rate <br><strong>({{cane_percentage|floatformat:2}}%)</strong></div>
                  
                  <div class="progress progress-thin mt-2">
                    <div class="progress-bar bg-info" role="progressbar" style="width: {{cane_percentage}}%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>
                <div class="col mb-sm-2 mb-0">
                  <div class="text-medium-emphasis">Events Approved Rate <br><strong>({{appr_percentage|floatformat:2}}%)</strong></div>
                  <div class="progress progress-thin mt-2">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: {{appr_percentage}}%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>
                <div class="col mb-sm-2 mb-0">
                  <div class="text-medium-emphasis">Archived Events Rate <br><strong>({{arch_percentage|floatformat:2}}%)</strong></div>
                  
                  <div class="progress progress-thin mt-2">
                    <div class="progress-bar bg-danger" role="progressbar" style="width: {{arch_percentage}}%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>
                
              </div>
            </div>
          </div>
          <!-- /.card.mb-4-->
          
          <!-- /.row-->

          <!-- /.row-->
        </div>

<script>
    $(function () {
        $('#id_password1').on('input', function () {
            var password1 = $('#id_password1').val();
            var alertDiv = $('#password-alert');
            
            var isLengthValid = password1.length >= 8;
            var hasUpperCase = /[A-Z]/.test(password1);
            var hasLowerCase = /[a-z]/.test(password1);
            var hasDigit = /\d/.test(password1);

            if (!isLengthValid || !hasUpperCase || !hasLowerCase || !hasDigit) {
                alertDiv.removeClass('alert-success').addClass('alert-danger');
                alertDiv.html('<strong>Password criteria:</strong><br>' +
                              '- Minimum 8 characters<br>' +
                              '- At least one uppercase letter<br>' +
                              '- At least one lowercase letter<br>' +
                              '- At least one digit');
            }
            else {
                alertDiv.removeClass('alert-danger').addClass('alert-success');
                alertDiv.text('Password meets the criteria.');
            }
        });
    });
</script>

{% endblock content %}